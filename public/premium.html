<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vers√£o Premium ‚Äî Mandante Consultoria IA</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --vermelho-angola: #C8102E;
            --verde-angola: #14B814;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
            background-attachment: fixed;
        }

        .container {
            max-width: 900px;
            margin: 40px auto;
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, #C8102E, #000, #F9D423);
            border-radius: 20px 20px 0 0;
        }

        h1 {
            color: var(--vermelho-angola);
            text-align: center;
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .subtitulo {
            text-align: center;
            color: #555;
            margin-bottom: 40px;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .imagem-plano {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 15px;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        textarea {
            width: 100%;
            height: 120px;
            padding: 20px;
            margin: 30px 0;
            border: 2px solid #eee;
            border-radius: 15px;
            font-size: 1rem;
            font-family: inherit;
            resize: none;
            transition: border 0.3s;
        }

        textarea:focus {
            border-color: var(--vermelho-angola);
            outline: none;
        }

        button {
            display: block;
            margin: 15px auto;
            background: var(--vermelho-angola);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(200, 16, 46, 0.3);
        }

        button:hover {
            background: #a00d24;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(200, 16, 46, 0.4);
        }

        #resposta {
            background: #fafafa;
            padding: 40px;
            margin-top: 40px;
            border-radius: 15px;
            white-space: pre-wrap;
            line-height: 1.8;
            font-size: 1.05rem;
            border-left: 5px solid var(--vermelho-angola);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.05);
            display: none;
        }
        
        #copiarBonus, #copiarPlano, #baixarPDF {
            display: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }

        #copiarBonus { background: var(--verde-angola); }
        #copiarBonus:hover { background: #0f8a0f; }

        #copiarPlano { background: #333; }
        #copiarPlano:hover { background: #555; }
        
        #baixarPDF { background: #0066cc; }
        #baixarPDF:hover { background: #004c99; }

        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--vermelho-angola);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .voltar {
            display: block;
            text-align: center;
            margin-top: 40px;
            color: #666;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s;
        }

        .voltar:hover {
            color: var(--vermelho-angola);
        }

        @media (max-width: 768px) {
            .container { padding: 30px 20px; }
            h1 { font-size: 1.8rem; }
            .imagem-plano { height: 200px; }
            textarea { height: 100px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üíé Vers√£o Premium ‚Äî Plano <span id="nomePlano">...</span></h1>
        <p class="subtitulo">Aqui voc√™ tem acesso √† IA 100% personalizada ‚Äî com respostas completas, n√∫meros exatos, estrat√©gias avan√ßadas e acompanhamento estrat√©gico, baseado na experi√™ncia pr√°tica do mercado angolano.</p>

        <img id="imagemPlano" class="imagem-plano" src="" alt="Imagem do plano selecionado">

        <textarea id="perguntaPremium" placeholder="Descreva sua ideia ou d√∫vida com o m√°ximo de detalhes..."></textarea>
        <button onclick="gerarRespostaPremium()">Gerar Resposta Premium</button>
        <div id="loading-spinner" class="spinner"></div>

        <div id="resposta"></div>

        <button id="copiarPlano" onclick="copiarTexto()">üìã Copiar Plano Completo</button>
        <button id="copiarBonus">üìã Copiar Apenas os B√¥nus (Contrato + Planilha)</button>
        <button id="baixarPDF" onclick="gerarPDF()">üìÑ Baixar Plano como PDF</button>

        <a href="index.html" class="voltar">‚Üê Voltar ao site principal</a>
    </div>


    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const plano = urlParams.get('plano');
        document.getElementById('nomePlano').innerText = plano ? plano.charAt(0).toUpperCase() + plano.slice(1) : '...';

        const imagensPorPlano = {
            'avancado': 'https://images.pexels.com/photos/4972611/pexels-photo-4972611.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1',
            'plus': 'https://images.pexels.com/photos/3184418/pexels-photo-3184418.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1',
            'empresarial': 'https://images.pexels.com/photos/4348404/pexels-photo-4348404.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1'
        };

        document.getElementById('imagemPlano').src = plano ? imagensPorPlano[plano] || imagensPorPlano['avancado'] : imagensPorPlano['avancado'];

        let gerando = false;

        async function gerarRespostaPremium() {
            if (gerando) return;

            const pergunta = document.getElementById('perguntaPremium').value;
            if (!pergunta.trim()) {
                alert("Por favor, descreva sua ideia com detalhes!");
                return;
            }

            const btn = document.querySelector('button[onclick="gerarRespostaPremium()"]');
            const respostaDiv = document.getElementById('resposta');
            const spinner = document.getElementById('loading-spinner');
            const actionButtons = [document.getElementById('copiarBonus'), document.getElementById('copiarPlano'), document.getElementById('baixarPDF')];

            
            gerando = true;
            btn.disabled = true;
            btn.innerText = "‚è≥ Gerando...";
            spinner.style.display = 'block';
            respostaDiv.style.display = 'none';
            actionButtons.forEach(b => b.style.display = 'none');

            try {
                // ALTERA√á√ÉO CR√çTICA AQUI: Envia a pergunta e o nome do plano para o servidor.
                const response = await fetch('https://hook.eu2.make.com/0rl6yh1r4qafs02fndfazr4sz39yirop', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        pergunta: pergunta,
                        plano: plano
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.erro || "Erro no servidor");
                }

                const data = await response.json();
                if (data.resposta) {
                    respostaDiv.innerText = data.resposta; // Usar innerText para preservar quebras de linha
                    respostaDiv.style.display = 'block';
                    
                    actionButtons.forEach(b => b.style.display = 'block');
                    if (!data.resposta.includes('MODELO DE CONTRATO')) {
                         document.getElementById('copiarBonus').style.display = 'none';
                    }

                } else {
                    respostaDiv.innerText = "‚ùå Desculpe, n√£o consegui gerar sua resposta. Tente novamente.";
                    respostaDiv.style.display = 'block';
                }
            } catch (error) {
                respostaDiv.innerText = `‚ùå ${error.message || "Servidor temporariamente indispon√≠vel. Tente mais tarde."}`;
                respostaDiv.style.display = 'block';
            } finally {
                gerando = false;
                btn.disabled = false;
                btn.innerText = "Gerar Resposta Premium";
                spinner.style.display = 'none';
            }
        }

        document.getElementById('copiarBonus').addEventListener('click', function() {
            const resposta = document.getElementById('resposta').innerText;
            const regex = /### (MODELO DE.*?)(?=###|$)/gs;
            const matches = [...resposta.matchAll(regex)];
            const bonusText = matches.map(match => match[0]).join('\n\n');

            if (bonusText) {
                navigator.clipboard.writeText(bonusText).then(() => {
                    alert('‚úÖ Modelos de b√¥nus copiados! Pode colar no Word ou Excel.');
                }).catch(() => {
                    alert('‚ùå Falha ao copiar. Tente manualmente.');
                });
            } else {
                alert('‚ùå Nenhum modelo de b√¥nus encontrado para copiar.');
            }
        });

        function copiarTexto() {
            const respostaDiv = document.getElementById('resposta');
            navigator.clipboard.writeText(respostaDiv.innerText).then(() => {
                alert('‚úÖ Plano completo copiado para a √°rea de transfer√™ncia!');
            }).catch(err => {
                console.error('Erro ao copiar texto: ', err);
                alert('‚ùå Falha ao copiar o plano. Tente manualmente.');
            });
        }
        
        function gerarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'p',
                unit: 'mm',
                format: 'a4'
            });

            const respostaTexto = document.getElementById('resposta').innerText;
            const margin = 15;
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const usableWidth = pageWidth - (2 * margin);
            
            doc.setFontSize(18);
            doc.text("Plano de Neg√≥cio Premium - Mandante Consultoria IA", pageWidth / 2, margin, { align: 'center' });
            
            doc.setFontSize(11);
            const lines = doc.splitTextToSize(respostaTexto, usableWidth);
            
            let cursorY = margin + 15;

            lines.forEach(line => {
                if (cursorY + 10 > pageHeight - margin) {
                    doc.addPage();
                    cursorY = margin;
                }
                doc.text(line, margin, cursorY);
                cursorY += 5;
            });

            doc.save('plano-premium-mandante-ia.pdf');
        }

    </script>
</body>
</html>

